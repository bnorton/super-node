__END__
SuperNode::Worker.perform_async(SuperNode::Invocation.new({'class' => 'App', 'method' => 'go'}).as_json)

def run_example
  inv = SuperNode::Invocation.new({ :class => 'Example', :method => 'fetch' }).as_json

  queue = SuperNode::Invocation.new({
    :class => 'SuperNode::Queue',
    :method => 'perform',
    :args => [{'invocation' => inv, 'interval' => 2}]
  }).as_json

  SuperNode::Worker.perform_async(queue)
end


def also_working
  inv = SuperNode::Invocation.new({
    'class' => 'Example',
    'method' => 'fetch'
  }).as_json

  queue = SuperNode::Queue.new({'invocation' => inv, 'interval' => 2}).to_invocation.as_json

  SuperNode::Worker.perform_async(queue)
end


def nike(count)
  resp = SuperNode::HTTP.new('http://graph.facebook.com').post({
    "access_token"=>"AAACEdEose0cBADYiBWYa8kgCQk6WavlUyvNIxSU9JghCMUnbmDBFcWrZBNR7ApZANvzGMA2VdlZCgUMRacrQkmhn8eZBCZBfmZACqOJljmiQZDZD",
    "batch"=>'[{"relative_url": "nike/feed?limit='+count.to_s+'", "method": "GET", "name": "nike-feed", "omit_response_on_success": false},{"relative_url": "?limit=300&ids={result=nike-feed:$.data.*.id}", "method": "GET", "name": "nike-ids"},{"depends_on": "nike-ids", "relative_url": "?ids={result=nike-ids:$.data.*.id}", "method": "GET", "omit_response_on_success": false}]'
  })

  parsed = JSON.parse resp.body
  body = parsed.first['body']
  items = JSON.parse body
  items['data'].count
end

resp = SuperNode::HTTP.new('http://graph.facebook.com').post({
  "access_token"=>"AAACEdEose0cBAP4ioGubJGnsNWMlSnuxkf9KcYmTTYS5qeZCDFDuxStbmmnSwWdmd4otRZBTfAVpsh8ePH0mrDp6QktM0ZCCs6vIIemuAZDZD",
  "batch"=>'[{"relative_url": "?ids=15087023444_10150572252118445,15087023444_10150572093343445", "method": "GET", "name": "nike-ids", "omit_response_on_success": false},{"relative_url": "?ids={result=nike-ids:$.data.*.id}", "method": "GET"}]'
})

parsed = JSON.parse resp.body


resp = SuperNode::HTTP.new('http://graph.facebook.com').post({
  "access_token"=>"AAACEdEose0cBAP4ioGubJGnsNWMlSnuxkf9KcYmTTYS5qeZCDFDuxStbmmnSwWdmd4otRZBTfAVpsh8ePH0mrDp6QktM0ZCCs6vIIemuAZDZD",
  "batch"=>'[{"relative_url": "?ids=' + ids[1..150].join(',') + '", "method": "GET"}]'
})

parsed = JSON.parse resp.body
body = parsed.first['body']
items = JSON.parse body
items.keys.count


ids = ["836202", "1111061", "1204197", "1229475", "1240201", "1241510", "1242866", "1245320", "2534778", "2536630", "2537789", "2539403", "3217131", "3308004", "3326179", "3430594", "3433098", "3620381", "4802203", "5507546", "6012747", "6017164", "6020828", "6024462", "6026978", "6313754", "6314329", "6420470", "11510385", "11513587", "13753527", "14502662", "15108383", "19909957", "19911249", "19912486", "24614767", "24614888", "24615198", "29007841", "30610969", "40303142", "62900529", "75200371", "106400004", "122606090", "201003606", "292200729", "500283435", "500403827", "500507731", "500605441", "500655610", "501378121", "506756518", "507237718", "507639042", "507686675", "509478532", "509792142", "513992662", "517747568", "520185479", "526941921", "535479645", "549856911", "566576947", "567960293", "580710344", "594975228", "599825434", "615213091", "616028423", "616042522", "621338919", "624643643", "637472495", "640282952", "642227626", "642676071", "646664076", "649172149", "656965454", "678295452", "679690413", "680963689", "690409936", "691028508", "694153090", "698944929", "705215518", "707035878", "713245439", "723415256", "723674506", "743170158", "760545392", "762872003", "802085146", "824566520", "856020598", "895470383", "1000650146", "1006248500", "1033576884", "1039860130", "1045625576", "1047748726", "1048920043", "1051909203", "1052370021", "1052370077", "1055475756", "1056840009", "1057890356", "1059720032", "1062074592", "1064550054", "1068060093", "1114836638", "1119723688", "1246553485", "1262817975", "1273886884", "1298620268", "1301825884", "1318238883", "1324450599", "1334595342", "1340842112", "1354413762", "1400640002", "1412060016", "1428510209", "1450020005", "1450099314", "1465594071", "1499932364", "1546003223", "1581904554", "1620098691", "1633306962", "1654661242", "1724872748", "1762881967", "1782808439", "1797222033", "100000025993849", "100000128175284", "100000173273977", "100000694191981", "100000793456902", "100001180837576", "100001526822404", "100002518620011", "100002988455045", "15087023444_10150572252118445", "15087023444_10150572093343445", "15087023444_10150571894683445", "15087023444_10150571701388445", "15087023444_184005348375361", "15087023444_254057228006697", "15087023444_10150569645623445", "15087023444_360084040682455", "15087023444_10150558263123445", "15087023444_10150558252878445", "15087023444_10150558238763445", "15087023444_10150558229943445", "15087023444_109256465868912", "15087023444_10150557189273445", "15087023444_361240020562349", "15087023444_318921891478433", "15087023444_10150542693043445", "15087023444_10150540313068445", "15087023444_10150537886788445", "15087023444_10150536432503445", "15087023444_10150535527043445", "15087023444_10150534109528445", "15087023444_10150533778423445", "15087023444_10150528470798445", "15087023444_10150515153443445", "182162001806727_369024196448557", "182162001806727_356883554334570", "182162001806727_356856901003902", "182162001806727_356853281004264", "182162001806727_356853064337619", "182162001806727_356850644337861", "182162001806727_347838951923642", "182162001806727_256033411142905", "182162001806727_356798651009727", "182162001806727_356793017676957", "182162001806727_356770844345841", "182162001806727_356762761013316", "182162001806727_356756991013893", "182162001806727_356752461014346", "182162001806727_356738407682418", "182162001806727_356723937683865", "182162001806727_356719501017642", "182162001806727_356707687685490", "182162001806727_356701797686079", "182162001806727_356673764355549", "182162001806727_356633167692942", "182162001806727_356609471028645", "182162001806727_190057244433080", "182162001806727_356565024366423", "7252381846_10150575869746847", "7252381846_10150575850151847", "7252381846_10150575156581847", "7252381846_10150568230361847", "7252381846_10150566826186847", "7252381846_10150566605341847", "7252381846_10150565986841847", "7252381846_10150564482486847", "7252381846_10150563740456847", "7252381846_10150563600746847", "7252381846_10150562455326847", "7252381846_10150561923661847", "7252381846_10150561514341847", "7252381846_10150561315301847", "7252381846_10150560136006847", "7252381846_10150560007746847", "7252381846_10150559843246847", "7252381846_10150559529741847", "7252381846_10150559048096847", "7252381846_10150557718141847", "7252381846_10150557377761847", "7252381846_10150557189841847", "7252381846_10150556541281847", "7252381846_10150546535186847", "7252381846_10150544430381847", "8103318119_10150635178373120", "8103318119_353984354634481", "8103318119_10150635163648120", "8103318119_10150635152733120", "8103318119_10150635149573120", "8103318119_10150635080958120", "8103318119_10150635065488120", "8103318119_10150635042783120", "8103318119_10150635041638120", "8103318119_10150635035533120", "8103318119_10150635011138120", "8103318119_10150635010208120", "8103318119_10150635006873120", "8103318119_10150634960833120", "8103318119_10150634920698120", "8103318119_196309377143301", "8103318119_10150634919308120", "8103318119_10150634908458120", "8103318119_10150634899608120", "8103318119_10150634883298120", "8103318119_10150634852548120", "8103318119_10150634848778120", "8103318119_10150634844648120", "106485550030_10150822535735031", "106485550030_10150822461690031", "106485550030_10150822109870031", "106485550030_10150822052160031", "106485550030_177831168994729", "106485550030_10150821936160031", "106485550030_10150821723175031", "106485550030_10150821610445031", "106485550030_10150821386675031", "106485550030_10150821329225031", "106485550030_10150821292330031", "106485550030_113791342083835", "106485550030_10150821165705031", "106485550030_10150821147805031", "106485550030_10150821118565031", "106485550030_10150821102930031", "106485550030_10150820937325031", "106485550030_10150820825930031", "106485550030_10150820823950031", "106485550030_10150820699985031", "106485550030_10150820636975031", "106485550030_10150820579315031", "106485550030_10150820513725031", "22166130048_10150534199541307", "22166130048_10150572207945913", "22166130048_10150688529290049", "22166130048_10150688484725049", "22166130048_10150688465355049", "22166130048_3101314084716", "22166130048_10150688364545049", "22166130048_10150688153810049", "22166130048_10150688148245049", "22166130048_10150688119025049", "22166130048_381983761831368", "22166130048_356368437716532", "22166130048_356367461049963", "22166130048_10150688035945049", "22166130048_276414889097169", "22166130048_292333110834344", "22166130048_10150687837225049", "22166130048_10150687832335049", "22166130048_10150687829525049", "22166130048_10150687828700049", "22166130048_10150687824030049", "22166130048_10150687808150049", "22166130048_10150687791325049", "22166130048_10150700363071425", "22166130048_10150687727005049", "5027904559_10150694007499560", "5027904559_10150694002504560", "5027904559_10150694002339560", "5027904559_10150694000599560", "5027904559_293200040746065", "5027904559_10150693984319560", "5027904559_377749882253505", "5027904559_376927192335348", "5027904559_10150693972629560", "5027904559_388606144486504", "5027904559_10150693969744560", "5027904559_285394518194079", "5027904559_10150693945774560", "5027904559_10150693944299560", "5027904559_374489632562288", "5027904559_10150693929299560", "5027904559_10150693913424560", "5027904559_10150693907324560", "5027904559_10150693903864560", "5027904559_10150693902959560", "5027904559_10150693902279560", "5027904559_10150693896844560", "5027904559_10150693893009560", "5027904559_10150693892769560", "5027904559_10150693891009560", "20531316728_10150867335071729", "20531316728_10150469721182131", "20531316728_10150457932027131", "20531316728_10150747697746729", "20531316728_10150747578131729", "20531316728_10150408335607131", "20531316728_10150408488962131", "20531316728_10150744919526729", "20531316728_10150393505147131", "20531316728_10150391956652131", "20531316728_10150378701937131", "20531316728_267683963283404", "20531316728_165296226899988", "20531316728_263325323713845", "20531316728_291364440887788", "20531316728_10150664700361729", "20531316728_296617733681934", "20531316728_227643797297134", "20531316728_243507375696500", "20531316728_120107468095483", "20531316728_198152410257702", "20531316728_10150420085741729", "20531316728_202223299844341", "20531316728_10150289612087131", "20531316728_268472399849975"]


resp = SuperNode::HTTP.new('http://graph.facebook.com').post({
  "access_token"=>"AAACEdEose0cBADYiBWYa8kgCQk6WavlUyvNIxSU9JghCMUnbmDBFcWrZBNR7ApZANvzGMA2VdlZCgUMRacrQkmhn8eZBCZBfmZACqOJljmiQZDZD",
  "batch"=>'[{"relative_url": "?ids=' + ids[1..20].join(',') + '", "method": "GET", "name": "first", "omit_response_on_success": false}, {"relative_url": "?ids={result=first:$.data..id}"}]'
})

parsed = JSON.parse resp.body
body = parsed.first['body']
items = JSON.parse body
items.keys.count


body = parsed.first['body']
items = JSON.parse body
items.keys.count
